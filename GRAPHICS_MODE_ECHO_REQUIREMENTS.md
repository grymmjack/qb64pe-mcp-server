# QB64PE Graphics Mode ECHO Requirements

## 🎯 **Critical Rule for LLMs**

### **MANDATORY**: Graphics Mode Console Output
```
⚠️  CRITICAL REQUIREMENT:

In ANY graphics screen mode (SCREEN 1, 2, 7, 8, 9, 10, 11, 12, 13, etc.):
- ALWAYS use ECHO functions for console output
- NEVER use PRINT or _PRINTSTRING for console output  
- ECHO works with stdio redirection while maintaining graphics display

Exception: Only use PRINT/_PRINTSTRING if user specifically requests it
```

## 🖼️ **Graphics Modes Requiring ECHO**

### VGA and SVGA Graphics Modes
```basic
SCREEN 1   ' 320x200, 4 colors (CGA)
SCREEN 2   ' 640x200, 2 colors (CGA) 
SCREEN 7   ' 320x200, 16 colors (EGA/VGA)
SCREEN 8   ' 640x200, 16 colors (EGA/VGA)
SCREEN 9   ' 640x350, 16 colors (EGA/VGA)
SCREEN 10  ' 640x350, 2 colors (EGA/VGA)
SCREEN 11  ' 640x480, 2 colors (VGA)
SCREEN 12  ' 640x480, 16 colors (VGA)
SCREEN 13  ' 320x200, 256 colors (VGA)
```

### Modern QB64PE Graphics Modes
```basic
SCREEN _NEWIMAGE(800, 600, 32)  ' Custom resolution, 32-bit color
SCREEN _NEWIMAGE(1024, 768, 256) ' Custom resolution, 256 colors
' Any _NEWIMAGE created screen mode
```

## 📝 **Important Distinctions**

### QB64PE ECHO vs Shell Echo
```
🚨 CRITICAL DISTINCTION:

QB64PE ECHO Functions (This Implementation):
- Subroutines within your QB64PE program
- Handle _DEST management automatically  
- Work with stdio redirection (program.exe > output.txt)
- Generated by QB64PE Logging Service

Shell Echo Commands (NOT the same):
- Built-in commands in shells (bash, cmd, PowerShell)
- echo "Hello World" in terminal/command prompt
- Completely different from QB64PE ECHO functions
```

## ✅ **Correct Usage Examples**

### Graphics Mode Programming
```basic
SCREEN 13  ' VGA 256-color mode
CALL ECHO("Initializing VGA graphics mode")
CALL ECHO_INFO("Resolution: 320x200x256")

' Load and display graphics
LOAD "sprite.bmp", sprite_image
CALL ECHO("Loaded sprite image")

' Game loop
FOR frame = 1 TO 1000
    ' Graphics rendering code here
    IF frame MOD 100 = 0 THEN
        CALL ECHO_DEBUG("Frame: " + STR$(frame))
    END IF
NEXT frame

CALL ECHO("Graphics demo complete")
```

### Text Mode (ECHO Still Recommended)
```basic
SCREEN 0  ' Text mode
CALL ECHO("Text mode program starting")
CALL ECHO_INFO("Processing data files")
' Text-based program logic
CALL ECHO("Program complete")
```

## ❌ **Incorrect Usage in Graphics Modes**

### DO NOT DO THIS in Graphics Modes
```basic
SCREEN 13  ' Graphics mode
PRINT "This won't be captured by stdio redirection!"  ' ❌ WRONG
_PRINTSTRING (10, 10), "This stays on graphics screen"  ' ❌ WRONG for console output
```

### Instead, Use ECHO
```basic
SCREEN 13  ' Graphics mode  
CALL ECHO("This will be captured by stdio redirection!")  ' ✅ CORRECT
_PRINTSTRING (10, 10), "This stays on graphics screen"    ' ✅ OK for graphics text
```

## 🔧 **Technical Explanation**

### Why ECHO is Required in Graphics Modes

1. **Graphics Modes Change Output Destination**: In graphics modes, PRINT and _PRINTSTRING default to the graphics screen surface, not the console.

2. **Stdio Redirection Doesn't Capture Graphics Output**: When you run `program.exe > output.txt`, only console output is captured.

3. **ECHO Functions Force Console Output**: The ECHO functions explicitly switch to `_CONSOLE` destination, ensuring output is captured.

4. **Automatic _DEST Management**: ECHO functions handle destination switching automatically, saving and restoring the current destination.

### ECHO Function Implementation
```basic
SUB ECHO (message AS STRING)
    DIM old_dest AS LONG
    old_dest = _DEST        ' Save current destination
    _DEST _CONSOLE          ' Switch to console
    PRINT message           ' Output to console
    _DEST old_dest          ' Restore original destination
END SUB
```

## 🎯 **LLM Implementation Guidelines**

### Decision Tree for Console Output
```
Is this a graphics mode (SCREEN != 0)?
├─ YES: Use ECHO functions (MANDATORY)
│   ├─ CALL ECHO("message")
│   ├─ CALL ECHO_INFO("info message")  
│   ├─ CALL ECHO_ERROR("error message")
│   └─ CALL ECHO_WARN("warning message")
├─ NO: ECHO functions still recommended
│   └─ Use ECHO for consistency
└─ EXCEPTION: User specifically requests PRINT/_PRINTSTRING
```

### Code Generation Rules
1. **Always include ECHO functions** in QB64PE programs that might use graphics
2. **Default to ECHO** for all console output unless user specifies otherwise
3. **Comment graphics mode requirements** in generated code
4. **Distinguish QB64PE ECHO from shell echo** in documentation

## 🚀 **Benefits of This Approach**

✅ **Consistent Output Capture**: Works reliably across all screen modes  
✅ **Automated Debugging**: LLM-generated code works with stdio redirection  
✅ **Simplified API**: No manual _DEST management required  
✅ **Graphics Compatibility**: Maintains graphics display while capturing console output  
✅ **Cross-Platform**: Works on Windows, Linux, macOS  

This implementation ensures that LLM-generated QB64PE code works correctly in all scenarios while providing clear, captured output for automated analysis and debugging.
