<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QB64PE Automation Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.8;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
        }

        .panel h2 {
            margin-bottom: 15px;
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .status-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .status-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .active {
            color: #00ff88;
        }

        .inactive {
            color: #ff6b6b;
        }

        .warning {
            color: #ffd93d;
        }

        .screenshot-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .screenshot-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .screenshot-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .screenshot-info {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .log-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 5px 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.05);
        }

        .log-timestamp {
            color: #888;
            margin-right: 10px;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn.danger {
            background: linear-gradient(45deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn.success {
            background: linear-gradient(45deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .feedback-list {
            max-height: 350px;
            overflow-y: auto;
        }

        .feedback-item {
            background: rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }

        .feedback-quality {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-right: 10px;
        }

        .quality-excellent { background: #00ff88; color: black; }
        .quality-good { background: #4ecdc4; color: black; }
        .quality-fair { background: #ffd93d; color: black; }
        .quality-poor { background: #ff6b6b; color: white; }

        .suggestion-count {
            float: right;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
        }

        .auto-refresh {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ QB64PE Automation Dashboard</h1>
        <p>Real-time monitoring of screenshot capture, analysis, and programming feedback</p>
    </div>

    <div class="dashboard">
        <!-- System Status Panel -->
        <div class="panel">
            <h2>üìä System Status</h2>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="monitoring-status">‚óè</div>
                    <div class="status-label">Screenshot Monitoring</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="watching-status">‚óè</div>
                    <div class="status-label">File Watching</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="processes-count">0</div>
                    <div class="status-label">QB64PE Processes</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="screenshots-count">0</div>
                    <div class="status-label">Screenshots Captured</div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn success" onclick="startMonitoring()">Start Monitoring</button>
                <button class="btn danger" onclick="stopMonitoring()">Stop Monitoring</button>
                <button class="btn" onclick="startWatching()">Start Watching</button>
                <button class="btn" onclick="captureScreenshot()">Capture Now</button>
            </div>
        </div>

        <!-- Recent Screenshots Panel -->
        <div class="panel">
            <h2>üì∏ Recent Screenshots</h2>
            <div class="screenshot-gallery" id="screenshot-gallery">
                <!-- Screenshots will be populated here -->
            </div>
        </div>

        <!-- Activity Log Panel -->
        <div class="panel">
            <h2>üìù Activity Log</h2>
            <div class="log-container" id="activity-log">
                <!-- Log entries will be populated here -->
            </div>
        </div>

        <!-- Programming Feedback Panel -->
        <div class="panel">
            <h2>üí° Programming Feedback</h2>
            <div class="feedback-list" id="feedback-list">
                <!-- Feedback entries will be populated here -->
            </div>
        </div>
    </div>

    <div class="auto-refresh">
        üîÑ Auto-refresh: <span id="refresh-countdown">30</span>s
    </div>

    <script>
        // Dashboard state
        let refreshInterval;
        let countdownInterval;
        let refreshCountdown = 30;

        // Initialize dashboard
        function initDashboard() {
            console.log('Initializing QB64PE Dashboard...');
            loadSystemStatus();
            loadRecentScreenshots();
            loadActivityLog();
            loadProgrammingFeedback();
            startAutoRefresh();
        }

        // Start auto-refresh cycle
        function startAutoRefresh() {
            refreshInterval = setInterval(() => {
                refreshDashboard();
                refreshCountdown = 30;
            }, 30000);

            countdownInterval = setInterval(() => {
                refreshCountdown--;
                document.getElementById('refresh-countdown').textContent = refreshCountdown;
                if (refreshCountdown <= 0) {
                    refreshCountdown = 30;
                }
            }, 1000);
        }

        // Refresh all dashboard data
        function refreshDashboard() {
            console.log('Refreshing dashboard data...');
            loadSystemStatus();
            loadRecentScreenshots();
            loadActivityLog();
            loadProgrammingFeedback();
        }

        // Load system status
        function loadSystemStatus() {
            // Mock data - in production this would call MCP server
            const mockStatus = {
                monitoring: Math.random() > 0.5,
                watching: Math.random() > 0.3,
                processes: Math.floor(Math.random() * 3),
                screenshots: Math.floor(Math.random() * 25) + 5
            };

            updateStatusDisplay('monitoring-status', mockStatus.monitoring);
            updateStatusDisplay('watching-status', mockStatus.watching);
            document.getElementById('processes-count').textContent = mockStatus.processes;
            document.getElementById('screenshots-count').textContent = mockStatus.screenshots;
        }

        // Update status display
        function updateStatusDisplay(elementId, isActive) {
            const element = document.getElementById(elementId);
            element.className = `status-value ${isActive ? 'active' : 'inactive'}`;
            element.textContent = isActive ? '‚óè' : '‚óè';
        }

        // Load recent screenshots
        function loadRecentScreenshots() {
            const gallery = document.getElementById('screenshot-gallery');
            
            // Mock screenshot data
            const mockScreenshots = [
                { name: 'basic-shapes-test.png', timestamp: new Date(Date.now() - 300000) },
                { name: 'color-palette-test.png', timestamp: new Date(Date.now() - 600000) },
                { name: 'text-rendering-test.png', timestamp: new Date(Date.now() - 900000) },
                { name: 'grid-layout-test.png', timestamp: new Date(Date.now() - 1200000) }
            ];

            gallery.innerHTML = mockScreenshots.map(screenshot => `
                <div class="screenshot-item">
                    <div style="width: 100%; height: 120px; background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8em;">
                        ${screenshot.name}
                    </div>
                    <div class="screenshot-info">
                        ${screenshot.timestamp.toLocaleTimeString()}
                    </div>
                </div>
            `).join('');
        }

        // Load activity log
        function loadActivityLog() {
            const logContainer = document.getElementById('activity-log');
            
            // Mock log entries
            const mockLogs = [
                { timestamp: new Date(), message: 'Screenshot captured: basic-shapes-test.png' },
                { timestamp: new Date(Date.now() - 120000), message: 'Analysis complete: 2 shapes, 3 colors detected' },
                { timestamp: new Date(Date.now() - 240000), message: 'Programming feedback generated: 4 suggestions' },
                { timestamp: new Date(Date.now() - 360000), message: 'QB64PE process detected: PID 1234' },
                { timestamp: new Date(Date.now() - 480000), message: 'Screenshot monitoring started' },
                { timestamp: new Date(Date.now() - 600000), message: 'File watching started for qb64pe-screenshots/' }
            ];

            logContainer.innerHTML = mockLogs.map(log => `
                <div class="log-entry">
                    <span class="log-timestamp">${log.timestamp.toLocaleTimeString()}</span>
                    ${log.message}
                </div>
            `).join('');

            // Auto-scroll to bottom
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Load programming feedback
        function loadProgrammingFeedback() {
            const feedbackList = document.getElementById('feedback-list');
            
            // Mock feedback data
            const mockFeedback = [
                {
                    quality: 'excellent',
                    timestamp: new Date(Date.now() - 180000),
                    suggestions: 2,
                    summary: 'Well-structured graphics with good color variety'
                },
                {
                    quality: 'good',
                    timestamp: new Date(Date.now() - 420000),
                    suggestions: 4,
                    summary: 'Basic shapes detected, consider adding text elements'
                },
                {
                    quality: 'fair',
                    timestamp: new Date(Date.now() - 660000),
                    suggestions: 6,
                    summary: 'Limited color palette, improve code organization'
                }
            ];

            feedbackList.innerHTML = mockFeedback.map(feedback => `
                <div class="feedback-item">
                    <div>
                        <span class="feedback-quality quality-${feedback.quality}">${feedback.quality.toUpperCase()}</span>
                        <span class="suggestion-count">${feedback.suggestions} suggestions</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 0.9em;">
                        ${feedback.summary}
                    </div>
                    <div style="margin-top: 5px; font-size: 0.8em; opacity: 0.7;">
                        ${feedback.timestamp.toLocaleString()}
                    </div>
                </div>
            `).join('');
        }

        // Control functions
        function startMonitoring() {
            console.log('Starting screenshot monitoring...');
            addLogEntry('Screenshot monitoring started');
            // In production: call MCP server start_screenshot_monitoring
        }

        function stopMonitoring() {
            console.log('Stopping screenshot monitoring...');
            addLogEntry('Screenshot monitoring stopped');
            // In production: call MCP server stop_screenshot_monitoring
        }

        function startWatching() {
            console.log('Starting file watching...');
            addLogEntry('File watching started');
            // In production: call MCP server start_screenshot_watching
        }

        function captureScreenshot() {
            console.log('Capturing screenshot...');
            addLogEntry('Manual screenshot capture triggered');
            // In production: call MCP server capture_qb64pe_screenshot
        }

        // Add log entry
        function addLogEntry(message) {
            const logContainer = document.getElementById('activity-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-timestamp">${new Date().toLocaleTimeString()}</span>
                ${message}
            `;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Initialize when page loads
        window.addEventListener('load', initDashboard);

        // Handle visibility change (pause auto-refresh when tab is hidden)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                if (refreshInterval) clearInterval(refreshInterval);
                if (countdownInterval) clearInterval(countdownInterval);
            } else {
                startAutoRefresh();
            }
        });
    </script>
</body>
</html>
